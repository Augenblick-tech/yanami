(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[615],{2403:(e,s,a)=>{Promise.resolve().then(a.bind(a,4885))},7846:(e,s,a)=>{"use strict";a.d(s,{U4:()=>l,id:()=>t,qx:()=>n});var r=a(7293);let t=async()=>(await r.h.get("/rules")).data,n=async e=>(await r.h.post("/rule",e)).data,l=async e=>(await r.h.delete("/rule?name=".concat(e))).data},4885:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>eg});var r=a(7437),t=a(7293);let n=async()=>(await t.h.get("/animes")).data,l=async e=>(await t.h.get("/anime/search/".concat(e))).data,i=async e=>(await t.h.get("/anime/records?name_id=".concat(e))).data,d=async e=>(await t.h.post("/anime",e)).data;var o=a(2265),c=a(2218),m=a(7440);let x=(0,c.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function u(e){let{className:s,variant:a,...t}=e;return(0,r.jsx)("div",{className:(0,m.cn)(x({variant:a}),s),...t})}function h(e){let{isActive:s,isToggling:a,activeText:t,inactiveText:n,onToggle:l}=e;return(0,r.jsx)(u,{variant:s?"default":"secondary",className:"whitespace-nowrap ".concat(a?"opacity-50 cursor-not-allowed":"cursor-pointer"),onClick:a?void 0:l,children:s?t:n})}var f=a(495),j=a(6013),p=a(571),g=a(1389),v=a(4867);let N=g.fC,b=g.xz,w=g.h_;g.x8;let y=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(g.aV,{ref:s,className:(0,m.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t})});y.displayName=g.aV.displayName;let _=o.forwardRef((e,s)=>{let{className:a,children:t,...n}=e;return(0,r.jsxs)(w,{children:[(0,r.jsx)(y,{}),(0,r.jsxs)(g.VY,{ref:s,className:(0,m.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[t,(0,r.jsxs)(g.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(v.Pxu,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});_.displayName=g.VY.displayName;let I=e=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,m.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...a})};I.displayName="DialogHeader";let z=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(g.Dx,{ref:s,className:(0,m.cn)("text-lg font-semibold leading-none tracking-tight",a),...t})});z.displayName=g.Dx.displayName;let C=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(g.dk,{ref:s,className:(0,m.cn)("text-sm text-muted-foreground",a),...t})});C.displayName=g.dk.displayName;var k=a(6661),R=a(3102),Y=a(9772);let S=Y.z.object({id:Y.z.number(),name:Y.z.string().min(1,"名称不能为空"),name_cn:Y.z.string(),name_tw:Y.z.string(),eps:Y.z.number().min(0,"集数不能为负数"),season:Y.z.number().min(1,"季度必须大于0"),weekday:Y.z.number().min(0).max(6,"星期必须在0-6之间"),air_date:Y.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"日期格式应为YYYY-MM-DD"),search_name:Y.z.string(),alternative_titles:Y.z.array(Y.z.string()).optional()}),G=Y.z.object({anime_info:S,rule_name:Y.z.string().min(1,"规则名称不能为空"),status:Y.z.boolean(),is_search:Y.z.boolean()});var J=a(1014),O=a(6463),T=a(9343),X=a(7776),W=a(9039),A=a(4697),E=a(4392),D=a(2421);let F=e=>{let{value:s,onChange:a,placeholder:t}=e,[n,l]=(0,o.useState)(""),[i,d]=(0,o.useState)(!1),c=e=>{a(s.filter((s,a)=>a!==e))},m=i?s:s.slice(0,3);return(0,r.jsxs)("div",{children:[(0,r.jsx)(R.I,{value:n,onChange:e=>{l(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&""!==n.trim()&&(e.preventDefault(),a([...s,n.trim()]),l(""))},placeholder:t||"输入别名并按回车添加"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[m.map((e,s)=>(0,r.jsxs)(u,{variant:"secondary",className:"flex items-center gap-1",children:[e,(0,r.jsx)("button",{type:"button",onClick:()=>c(s),className:"text-xs",children:(0,r.jsx)(A.Z,{size:12})})]},s)),s.length>3&&(0,r.jsx)("button",{type:"button",onClick:()=>d(!i),className:"text-sm text-gray-500 flex items-center",children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E.Z,{size:16}),"收起"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.Z,{size:16}),"还有 ",s.length-3," 个"]})})]})]})},P={name:"",name_cn:"",name_tw:"",eps:0,season:1,weekday:0,air_date:"",search_name:"",alternative_titles:[]},Z=S.omit({id:!0}),M=e=>{let{open:s,setOpen:a,anime:t}=e,n=t.anime_info,l=(0,O.useSearchParams)().get("search"),i=(0,T.cI)({resolver:(0,J.F)(Z),defaultValues:n});(0,o.useEffect)(()=>{s&&i.reset(n)},[s,n,i]);let c=async e=>{await d({...t,anime_info:{...n,...e}}),await (0,W.JG)("/animes"),await (0,W.JG)(["/animes",l]),X.Am.success("动漫已更新",{description:"动漫已成功更新。"}),a(!1)};return(0,r.jsx)(N,{open:s,onOpenChange:e=>{a(e),e||i.reset(P)},children:(0,r.jsxs)(_,{className:"sm:max-w-[625px] w-[95vw] max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(I,{children:[(0,r.jsx)(z,{children:"更新动漫"}),(0,r.jsx)(C,{children:"更新动漫信息。"})]}),(0,r.jsx)(k.l0,{...i,children:(0,r.jsxs)("form",{onSubmit:i.handleSubmit(c),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsx)(k.Wi,{control:i.control,name:"name",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"名称"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:i.control,name:"search_name",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"搜索名称"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsx)(k.Wi,{control:i.control,name:"name_cn",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"中文名（简体）"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:i.control,name:"name_tw",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"中文名（繁体）"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:i.control,name:"alternative_titles",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{className:"col-span-full",children:[(0,r.jsx)(k.lX,{children:"别名"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(F,{value:s.value||[],onChange:s.onChange})}),(0,r.jsx)(k.zG,{})]})}})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(0,r.jsx)(k.Wi,{control:i.control,name:"eps",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"集数"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{type:"number",...s,onChange:e=>s.onChange(parseInt(e.target.value))})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:i.control,name:"season",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"季度"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{type:"number",...s,onChange:e=>s.onChange(parseInt(e.target.value))})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:i.control,name:"weekday",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"放送日"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{type:"number",...s,onChange:e=>s.onChange(parseInt(e.target.value))})}),(0,r.jsx)(k.pf,{children:"0-6（周日-周六）"}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:i.control,name:"air_date",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"首播日期"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s,placeholder:"YYYY-MM-DD"})}),(0,r.jsx)(k.zG,{})]})}})]}),(0,r.jsx)("div",{className:"flex justify-end pt-4",children:(0,r.jsx)(f.z,{type:"submit",children:"更新动漫"})})]})})]})})};var V=a(6975),L=a(518),U=a(7592);function B(e){let{animeId:s,open:a,onOpenChange:t}=e,[n,l]=(0,o.useState)(1),{data:d,error:c,isLoading:m}=(0,W.ZP)(s&&a?"/anime/records?name_id=".concat(s):null,()=>i(s||0));if((0,o.useEffect)(()=>{m||d||!a||(X.Am.error("获取下载记录失败"),t())},[m,t,a,d]),m||!d&&!c)return null;let x=null==d?void 0:d.slice((n-1)*10,10*n),u=Math.ceil(((null==d?void 0:d.length)||0)/10);return(0,r.jsx)(N,{open:a,onOpenChange:t,children:(0,r.jsxs)(_,{className:"sm:max-w-[625px] w-[95vw] max-h-[90vh] overflow-y-auto flex flex-col",children:[(0,r.jsxs)(I,{children:[(0,r.jsx)(z,{children:"番剧下载记录"}),(0,r.jsxs)(C,{children:[null==d?void 0:d.length,"条下载记录"]})]}),c?(0,r.jsxs)("p",{className:"text-red-500",children:["获取下载记录失败: ",c.message]}):(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto overflow-x-hidden",children:[(0,r.jsx)("div",{className:"hidden md:block",children:(0,r.jsxs)(V.iA,{children:[(0,r.jsx)(V.xD,{children:(0,r.jsxs)(V.SC,{children:[(0,r.jsx)(V.ss,{className:"whitespace-nowrap",children:"标题"}),(0,r.jsx)(V.ss,{className:"whitespace-nowrap",children:"规则名称"}),(0,r.jsx)(V.ss,{className:"whitespace-nowrap",children:"磁力链接"}),(0,r.jsx)(V.ss,{className:"whitespace-nowrap",children:"信息哈希"})]})}),(0,r.jsx)(V.RM,{children:null==d?void 0:d.map((e,s)=>(0,r.jsxs)(V.SC,{children:[(0,r.jsx)(V.pj,{className:"break-all",children:e.title}),(0,r.jsx)(V.pj,{className:"break-all",children:e.rule_name}),(0,r.jsx)(V.pj,{children:(0,r.jsx)("a",{href:e.magnet,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"磁力链接"})}),(0,r.jsx)(V.pj,{className:"break-all",children:e.info_hash})]},s))})]})}),(0,r.jsx)("div",{className:"md:hidden space-y-4",children:null==x?void 0:x.map((e,s)=>(0,r.jsxs)(j.Zb,{children:[(0,r.jsx)(j.Ol,{children:(0,r.jsx)(j.ll,{className:"text-sm",children:e.title})}),(0,r.jsxs)(j.aY,{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"规则名称："}),(0,r.jsx)("span",{className:"break-all",children:e.rule_name})]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"磁力链接："}),(0,r.jsx)("a",{href:e.magnet,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline break-all",children:"点击打开"})]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"信息哈希："}),(0,r.jsx)("span",{className:"break-all",children:e.info_hash})]})]})]},s))})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-4 pt-2 border-t",children:[(0,r.jsxs)(f.z,{onClick:()=>l(e=>Math.max(1,e-1)),disabled:1===n,children:[(0,r.jsx)(L.Z,{className:"h-4 w-4 mr-2"}),"上一页"]}),(0,r.jsxs)("span",{children:[n," / ",u]}),(0,r.jsxs)(f.z,{onClick:()=>l(e=>Math.min(u,e+1)),disabled:n===u,children:["下一页",(0,r.jsx)(U.Z,{className:"h-4 w-4 ml-2"})]})]})]})})}function H(e){let{anime:s,toggleAnimeStatus:a,toggleAnimeSearch:t}=e,[n,l]=(0,o.useState)(null),[i,d]=(0,o.useState)(!1),[c,m]=(0,o.useState)(!1),[x,g]=(0,o.useState)(void 0),v=e=>{l(n===e?null:e)},N=async()=>{d(!0),await a(s.anime_info.id,!s.status,s),d(!1)},b=async()=>{m(!0),await t(s.anime_info.id,!s.is_search,s),m(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(j.Zb,{className:"flex flex-col",children:[(0,r.jsxs)(j.Ol,{children:[(0,r.jsx)(j.ll,{className:"text-lg",children:s.anime_info.name}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,r.jsx)(h,{isActive:s.status,isToggling:i,activeText:"活跃",inactiveText:"非活跃",onToggle:N}),(0,r.jsx)(h,{isActive:s.is_search,isToggling:c,activeText:"搜索中",inactiveText:"未搜索",onToggle:b})]})]}),(0,r.jsxs)(j.aY,{className:"flex flex-col flex-grow",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"中文名:"})," ",s.anime_info.name_cn||s.anime_info.name_tw]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"集数:"})," ",s.anime_info.eps]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"季度:"})," ",s.anime_info.season]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"放送日:"})," ",["周日","周一","周二","周三","周四","周五","周六"][s.anime_info.weekday]||"未知"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"首播日期:"})," ",s.anime_info.air_date]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"规则:"})," ",s.rule_name]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:(0,r.jsx)("strong",{children:"更新进度"})}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:[s.progress||"0","%"]})]}),(0,r.jsx)(p.E,{value:s.progress,className:"w-full"})]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("p",{className:"mb-1",children:(0,r.jsx)("strong",{children:"别名:"})}),s.anime_info.alternative_titles&&s.anime_info.alternative_titles.length>0?(0,r.jsxs)(r.Fragment,{children:[(n===s.anime_info.id?s.anime_info.alternative_titles:s.anime_info.alternative_titles.slice(0,3)).map((e,s)=>(0,r.jsx)(u,{variant:"secondary",className:"mr-1 mb-1",children:e},s)),s.anime_info.alternative_titles.length>3&&(0,r.jsx)(f.z,{variant:"link",size:"sm",onClick:()=>v(s.anime_info.id),className:"mt-2 text-xs font-semibold text-blue-600 hover:text-blue-800 transition-colors duration-200",children:n===s.anime_info.id?"收起":"展开 (".concat(s.anime_info.alternative_titles.length-3,")")})]}):(0,r.jsx)("span",{className:"text-gray-500",children:"无别名"})]}),(0,r.jsxs)("div",{className:"mt-auto pt-4 flex space-x-2",children:[(0,r.jsx)(f.z,{variant:"outline",size:"sm",onClick:()=>g("edit"),children:"编辑信息"}),(0,r.jsx)(f.z,{variant:"outline",size:"sm",onClick:()=>g("view"),children:"查看下载记录"})]})]})]}),(0,r.jsx)(M,{open:"edit"===x,setOpen:()=>g(void 0),anime:s}),(0,r.jsx)(B,{animeId:s.anime_info.id,open:"view"===x,onOpenChange:()=>g(void 0)})]})}var q=a(2170),$=a.n(q),K=a(7735);let Q=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(K.mY,{ref:s,className:(0,m.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...t})});Q.displayName=K.mY.displayName;let ee=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,r.jsx)(v._Ve,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,r.jsx)(K.mY.Input,{ref:s,className:(0,m.cn)("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...t})]})});ee.displayName=K.mY.Input.displayName;let es=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(K.mY.List,{ref:s,className:(0,m.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...t})});es.displayName=K.mY.List.displayName;let ea=o.forwardRef((e,s)=>(0,r.jsx)(K.mY.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));ea.displayName=K.mY.Empty.displayName;let er=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(K.mY.Group,{ref:s,className:(0,m.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...t})});er.displayName=K.mY.Group.displayName,o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(K.mY.Separator,{ref:s,className:(0,m.cn)("-mx-1 h-px bg-border",a),...t})}).displayName=K.mY.Separator.displayName;let et=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(K.mY.Item,{ref:s,className:(0,m.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",a),...t})});et.displayName=K.mY.Item.displayName;var en=a(5123);let el=en.fC,ei=en.xz;en.ee;let ed=o.forwardRef((e,s)=>{let{className:a,align:t="center",sideOffset:n=4,...l}=e;return(0,r.jsx)(en.h_,{children:(0,r.jsx)(en.VY,{ref:s,align:t,sideOffset:n,className:(0,m.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});ed.displayName=en.VY.displayName;var eo=a(1459);let ec=o.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(eo.fC,{className:(0,m.cn)("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...t,ref:s,children:(0,r.jsx)(eo.bU,{className:(0,m.cn)("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})});ec.displayName=eo.fC.displayName;var em=a(7802),ex=a(1282),eu=a(2468);let eh={anime_info:{id:0,name:"",name_cn:"",name_tw:"",eps:0,season:1,weekday:0,air_date:"",search_name:"",alternative_titles:[]},rule_name:"",status:!1,is_search:!1},ef=()=>{let[e,s]=(0,o.useState)(!1),{data:a}=(0,em.k)(e),t=(0,T.cI)({resolver:(0,J.F)(G),defaultValues:eh}),n=async e=>{await d(e),await (0,W.JG)("/animes"),X.Am.success("新动漫已添加",{description:"新的动漫已成功添加到列表中。"}),s(!1)};return(0,r.jsxs)(N,{open:e,onOpenChange:e=>{s(e),t.reset(eh)},children:[(0,r.jsx)(b,{asChild:!0,children:(0,r.jsx)(f.z,{children:"新增动漫"})}),(0,r.jsxs)(_,{className:"sm:max-w-[625px] w-[95vw] max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(I,{children:[(0,r.jsx)(z,{children:"新增动漫"}),(0,r.jsx)(C,{children:"添加新的动漫到列表中。"})]}),(0,r.jsx)(k.l0,{...t,children:(0,r.jsxs)("form",{onSubmit:t.handleSubmit(n),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.id",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"ID"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{type:"number",...s,onChange:e=>s.onChange(parseInt(e.target.value))})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.name",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"名称"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.search_name",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"搜索名称"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.name_cn",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"中文名（简体）"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.name_tw",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"中文名（繁体）"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.alternative_titles",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{className:"col-span-full",children:[(0,r.jsx)(k.lX,{children:"别名"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(F,{value:s.value||[],onChange:s.onChange})}),(0,r.jsx)(k.zG,{})]})}})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.eps",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"集数"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{type:"number",...s,onChange:e=>s.onChange(parseInt(e.target.value))})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.season",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"季度"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{type:"number",...s,onChange:e=>s.onChange(parseInt(e.target.value))})}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.weekday",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"放送日"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{type:"number",...s,onChange:e=>s.onChange(parseInt(e.target.value))})}),(0,r.jsx)(k.pf,{children:"0-6（周日-周六）"}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"anime_info.air_date",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{children:[(0,r.jsx)(k.lX,{children:"首播日期"}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(R.I,{...s,placeholder:"YYYY-MM-DD"})}),(0,r.jsx)(k.zG,{})]})}})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsx)(k.Wi,{control:t.control,name:"rule_name",render:e=>{var s;let{field:n}=e;return(0,r.jsxs)(k.xJ,{className:"flex flex-col",children:[(0,r.jsx)(k.lX,{children:"规则名称"}),(0,r.jsxs)(el,{children:[(0,r.jsx)(ei,{asChild:!0,children:(0,r.jsx)(k.NI,{children:(0,r.jsxs)(f.z,{variant:"outline",role:"combobox",className:(0,m.cn)("w-full justify-between",!n.value&&"text-muted-foreground"),children:[n.value?null==a?void 0:null===(s=a.find(e=>e.name===n.value))||void 0===s?void 0:s.name:"选择规则",(0,r.jsx)(ex.Z,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),(0,r.jsx)(ed,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,r.jsxs)(Q,{children:[(0,r.jsx)(ee,{placeholder:"搜索规则..."}),(0,r.jsx)(ea,{children:"未找到规则。"}),(0,r.jsx)(er,{children:(0,r.jsx)(es,{children:null==a?void 0:a.map(e=>(0,r.jsxs)(et,{value:e.name,onSelect:()=>{t.setValue("rule_name",e.name)},children:[(0,r.jsx)(eu.Z,{className:(0,m.cn)("mr-2 h-4 w-4",e.name===n.value?"opacity-100":"opacity-0")}),e.name]},e.name))})})]})})]}),(0,r.jsx)(k.zG,{})]})}}),(0,r.jsx)(k.Wi,{control:t.control,name:"status",render:e=>{let{field:s}=e;return(0,r.jsxs)(k.xJ,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,r.jsxs)("div",{className:"space-y-0.5",children:[(0,r.jsx)(k.lX,{className:"text-base",children:"状态"}),(0,r.jsx)(k.pf,{children:"启用或禁用此动漫"})]}),(0,r.jsx)(k.NI,{children:(0,r.jsx)(ec,{checked:s.value,onCheckedChange:s.onChange})})]})}})]}),(0,r.jsx)("div",{className:"flex justify-end pt-4",children:(0,r.jsx)(f.z,{type:"submit",children:"添加动漫"})})]})})]})]})};var ej=a(2738);function ep(){return(0,r.jsxs)(j.Zb,{className:"flex flex-col",children:[(0,r.jsxs)(j.Ol,{children:[(0,r.jsx)(ej.O,{className:"h-6 w-3/4"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(0,r.jsx)(ej.O,{className:"h-6 w-20"}),(0,r.jsx)(ej.O,{className:"h-6 w-20"})]})]}),(0,r.jsxs)(j.aY,{className:"flex flex-col flex-grow",children:[[...Array(6)].map((e,s)=>(0,r.jsx)(ej.O,{className:"h-4 w-full mt-2"},s)),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)(ej.O,{className:"h-4 w-20"}),(0,r.jsx)(ej.O,{className:"h-4 w-10"})]}),(0,r.jsx)(ej.O,{className:"h-2 w-full"})]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)(ej.O,{className:"h-4 w-16 mb-1"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:[void 0,void 0,void 0].map((e,s)=>(0,r.jsx)(ej.O,{className:"h-6 w-16"},s))})]}),(0,r.jsxs)("div",{className:"mt-auto pt-4 flex space-x-2",children:[(0,r.jsx)(ej.O,{className:"h-8 w-24"}),(0,r.jsx)(ej.O,{className:"h-8 w-32"})]})]})]})}function eg(){let e=(0,O.useRouter)(),s=(0,O.useSearchParams)(),a=s.get("search")||"",[t,i]=(0,o.useState)(a),[c,m]=(0,o.useState)(a),{data:x,isLoading:u,mutate:h}=(0,W.ZP)(c?["/animes",c]:"/animes",c?()=>l(c):n),f=(0,o.useMemo)(()=>$()(e=>m(e),300),[]);(0,o.useEffect)(()=>{let a=new URLSearchParams(s);c?a.set("search",c):a.delete("search"),e.push("/anime?".concat(a.toString()))},[e,c,s]);let j=async(e,s,a)=>{try{await d({...a,status:s}),await h(),X.Am.success("状态已更新",{description:"动漫状态已成功更新。"})}catch(e){X.Am.error("更新失败",{description:"无法更新动漫状态，请稍后重试。"})}},p=async(e,s,a)=>{try{await d({...a,is_search:s}),await h(),X.Am.success("搜索状态已更新",{description:"动漫搜索状态已成功更新。"})}catch(e){X.Am.error("更新失败",{description:"无法更新动漫搜索状态，请稍后重试。"})}};return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold",children:"动漫列表"}),(0,r.jsx)(ef,{})]}),(0,r.jsx)(R.I,{type:"text",placeholder:"搜索动漫...",value:t,onChange:e=>{let s=e.target.value;i(s),f(s)},className:"max-w-sm"}),(0,r.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:u?Array(6).fill(0).map((e,s)=>(0,r.jsx)(ep,{},s)):null==x?void 0:x.map(e=>(0,r.jsx)(H,{anime:e,toggleAnimeStatus:j,toggleAnimeSearch:p},e.anime_info.id))})]})}},495:(e,s,a)=>{"use strict";a.d(s,{z:()=>o});var r=a(7437),t=a(2265),n=a(1538),l=a(2218),i=a(7440);let d=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),o=t.forwardRef((e,s)=>{let{className:a,variant:t,size:l,asChild:o=!1,...c}=e,m=o?n.g7:"button";return(0,r.jsx)(m,{className:(0,i.cn)(d({variant:t,size:l,className:a})),ref:s,...c})});o.displayName="Button"},6013:(e,s,a)=>{"use strict";a.d(s,{Ol:()=>i,SZ:()=>o,Zb:()=>l,aY:()=>c,ll:()=>d});var r=a(7437),t=a(2265),n=a(7440);let l=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",a),...t})});l.displayName="Card";let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...t})});i.displayName="CardHeader";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("h3",{ref:s,className:(0,n.cn)("font-semibold leading-none tracking-tight",a),...t})});d.displayName="CardTitle";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",a),...t})});o.displayName="CardDescription";let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",a),...t})});c.displayName="CardContent",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",a),...t})}).displayName="CardFooter"},6661:(e,s,a)=>{"use strict";a.d(s,{l0:()=>m,NI:()=>g,pf:()=>v,Wi:()=>u,xJ:()=>j,lX:()=>p,zG:()=>N});var r=a(7437),t=a(2265),n=a(1538),l=a(9343),i=a(7440),d=a(8364);let o=(0,a(2218).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(d.f,{ref:s,className:(0,i.cn)(o(),a),...t})});c.displayName=d.f.displayName;let m=l.RV,x=t.createContext({}),u=e=>{let{...s}=e;return(0,r.jsx)(x.Provider,{value:{name:s.name},children:(0,r.jsx)(l.Qr,{...s})})},h=()=>{let e=t.useContext(x),s=t.useContext(f),{getFieldState:a,formState:r}=(0,l.Gc)(),n=a(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=s;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...n}},f=t.createContext({}),j=t.forwardRef((e,s)=>{let{className:a,...n}=e,l=t.useId();return(0,r.jsx)(f.Provider,{value:{id:l},children:(0,r.jsx)("div",{ref:s,className:(0,i.cn)("space-y-2",a),...n})})});j.displayName="FormItem";let p=t.forwardRef((e,s)=>{let{className:a,...t}=e,{error:n,formItemId:l}=h();return(0,r.jsx)(c,{ref:s,className:(0,i.cn)(n&&"text-destructive",a),htmlFor:l,...t})});p.displayName="FormLabel";let g=t.forwardRef((e,s)=>{let{...a}=e,{error:t,formItemId:l,formDescriptionId:i,formMessageId:d}=h();return(0,r.jsx)(n.g7,{ref:s,id:l,"aria-describedby":t?"".concat(i," ").concat(d):"".concat(i),"aria-invalid":!!t,...a})});g.displayName="FormControl";let v=t.forwardRef((e,s)=>{let{className:a,...t}=e,{formDescriptionId:n}=h();return(0,r.jsx)("p",{ref:s,id:n,className:(0,i.cn)("text-[0.8rem] text-muted-foreground",a),...t})});v.displayName="FormDescription";let N=t.forwardRef((e,s)=>{let{className:a,children:t,...n}=e,{error:l,formMessageId:d}=h(),o=l?String(null==l?void 0:l.message):t;return o?(0,r.jsx)("p",{ref:s,id:d,className:(0,i.cn)("text-[0.8rem] font-medium text-destructive",a),...n,children:o}):null});N.displayName="FormMessage"},3102:(e,s,a)=>{"use strict";a.d(s,{I:()=>l});var r=a(7437),t=a(2265),n=a(7440);let l=t.forwardRef((e,s)=>{let{className:a,type:t,...l}=e;return(0,r.jsx)("input",{type:t,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...l})});l.displayName="Input"},571:(e,s,a)=>{"use strict";a.d(s,{E:()=>i});var r=a(7437),t=a(2265),n=a(6506),l=a(7440);let i=t.forwardRef((e,s)=>{let{className:a,value:t,...i}=e;return(0,r.jsx)(n.fC,{ref:s,className:(0,l.cn)("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...i,children:(0,r.jsx)(n.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(t||0),"%)")}})})});i.displayName=n.fC.displayName},2738:(e,s,a)=>{"use strict";a.d(s,{O:()=>n});var r=a(7437),t=a(7440);function n(e){let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-primary/10",s),...a})}},6975:(e,s,a)=>{"use strict";a.d(s,{RM:()=>d,SC:()=>o,iA:()=>l,pj:()=>m,ss:()=>c,xD:()=>i});var r=a(7437),t=a(2265),n=a(7440);let l=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:s,className:(0,n.cn)("w-full caption-bottom text-sm",a),...t})})});l.displayName="Table";let i=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("thead",{ref:s,className:(0,n.cn)("[&_tr]:border-b",a),...t})});i.displayName="TableHeader";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tbody",{ref:s,className:(0,n.cn)("[&_tr:last-child]:border-0",a),...t})});d.displayName="TableBody",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tfoot",{ref:s,className:(0,n.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...t})}).displayName="TableFooter";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tr",{ref:s,className:(0,n.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...t})});o.displayName="TableRow";let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("th",{ref:s,className:(0,n.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t})});c.displayName="TableHead";let m=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("td",{ref:s,className:(0,n.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...t})});m.displayName="TableCell",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("caption",{ref:s,className:(0,n.cn)("mt-4 text-sm text-muted-foreground",a),...t})}).displayName="TableCaption"},7802:(e,s,a)=>{"use strict";a.d(s,{k:()=>n});var r=a(7846),t=a(9039);let n=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return(0,t.ZP)(e?"/rules":null,r.id)}},7293:(e,s,a)=>{"use strict";a.d(s,{h:()=>t});var r=a(7776);let t=function(e){let{baseUrl:s}=e,a=[],r=[],t=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(s).concat(e),l={...t};for(let e of a)l=e(l);let i=await fetch(n,l);for(let e of r){let s=await e(i);if("code"in s)return s;i=s}if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));let d=await i.json();if(0!==d.code&&200!==d.code)throw Error("API error! code: ".concat(d.code,", message: ").concat(d.msg));return d};return{request:t,get:(e,s)=>t(e,{...s,method:"GET"}),post:(e,s,a)=>t(e,{...a,method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json",...null==a?void 0:a.headers}}),delete:(e,s)=>t(e,{...s,method:"DELETE"}),put:(e,s,a)=>t(e,{...a,method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json",...null==a?void 0:a.headers}}),addRequestInterceptor:e=>{a.push(e)},addResponseInterceptor:e=>{r.push(e)}}}({baseUrl:a(357).env.NEXT_PUBLIC_API_BASE_URL||"/v1"});t.addRequestInterceptor(e=>{let s=localStorage.getItem("token");return s?{...e,headers:{...e.headers,Authorization:"Bearer ".concat(s)}}:e}),t.addResponseInterceptor(async e=>{if(401===e.status)return e;let s=await e.clone().json();return 0!==s.code&&200!==s.code?(r.Am.error(s.msg),Promise.reject(s.msg)):e})},7440:(e,s,a)=>{"use strict";a.d(s,{cn:()=>n});var r=a(4839),t=a(6164);function n(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,t.m6)((0,r.W)(s))}}},e=>{var s=s=>e(e.s=s);e.O(0,[310,776,976,446,39,567,130,215,744],()=>s(2403)),_N_E=e.O()}]);