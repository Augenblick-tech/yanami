(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[412],{2150:(e,r,s)=>{Promise.resolve().then(s.bind(s,4743))},4915:(e,r,s)=>{"use strict";s.d(r,{EZ:()=>o,gQ:()=>l,x4:()=>a,z2:()=>n});var t=s(7293);let a=async e=>(await t.h.post("/login",e)).data,n=async e=>(await t.h.post("/register",e)).data,o=async e=>(await t.h.get("/register/code?timers=".concat(e.timers,"&expire=").concat(e.expire))).data,l=async e=>(await t.h.post("/user",e)).data},4743:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>v});var t=s(7437),a=s(4915),n=s(7293);let o=async()=>(await n.h.get("/config")).data,l=async e=>(await n.h.post("/config",e)).data;var i=s(495),d=s(6661),c=s(3102),m=s(9772);let u=m.z.object({password:m.z.string(),url:m.z.string(),username:m.z.string()}),x=m.z.object({path:m.z.string(),qbit_config:u.optional()});var h=s(1014),f=s(2265),p=s(9343),j=s(7776),w=s(9039),g=s(2738);function b(){return(0,t.jsxs)("div",{children:[(0,t.jsx)(g.O,{className:"h-10 w-48 mb-6"}),(0,t.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,t.jsx)(g.O,{className:"h-6 w-24"}),(0,t.jsx)(g.O,{className:"h-10 w-full"}),(0,t.jsx)(g.O,{className:"h-6 w-36 mt-6"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(g.O,{className:"h-10 w-full"}),(0,t.jsx)(g.O,{className:"h-10 w-full"}),(0,t.jsx)(g.O,{className:"h-10 w-full"})]}),(0,t.jsx)(g.O,{className:"h-10 w-24 mt-4"})]}),(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsx)(g.O,{className:"h-8 w-32 mb-4"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(g.O,{className:"h-6 w-16"}),(0,t.jsx)(g.O,{className:"h-10 w-full"}),(0,t.jsx)(g.O,{className:"h-6 w-16"}),(0,t.jsx)(g.O,{className:"h-10 w-full"}),(0,t.jsx)(g.O,{className:"h-6 w-24"}),(0,t.jsx)(g.O,{className:"h-10 w-full"}),(0,t.jsx)(g.O,{className:"h-10 w-24 mt-4"})]})]})]})}function v(){let{data:e,isLoading:r,mutate:s}=(0,w.ZP)("config",o),n=(0,p.cI)({resolver:(0,h.F)(x),defaultValues:{path:"",qbit_config:{username:"",password:"",url:""}}});(0,f.useEffect)(()=>{if(e){var r,s,t;n.reset({path:e.path,qbit_config:{username:(null===(r=e.qbit_config)||void 0===r?void 0:r.username)||"",password:(null===(s=e.qbit_config)||void 0===s?void 0:s.password)||"",url:(null===(t=e.qbit_config)||void 0===t?void 0:t.url)||""}})}},[e,n]);let m=async e=>{let r=e.qbit_config,t=!r||Object.values(r).every(e=>""===e),a=!!r&&Object.values(r).some(e=>""===e);if(!t&&a){j.Am.error("请填写完整的 qBittorrent 配置");return}await l({...e,qbit_config:t?void 0:r}),s(),j.Am.success("配置已更新")},u=(0,p.cI)({defaultValues:{oldPassword:"",newPassword:"",confirmPassword:""}}),g=async e=>{if(e.newPassword!==e.confirmPassword){j.Am.error("两次输入的新密码不一致");return}try{await (0,a.gQ)({old_password:e.oldPassword,new_password:e.newPassword}),j.Am.success("密码已更新"),u.reset()}catch(e){j.Am.error("更新密码失败")}};return r?(0,t.jsx)(b,{}):(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"系统配置"}),(0,t.jsx)(d.l0,{...n,children:(0,t.jsxs)("form",{onSubmit:n.handleSubmit(m),className:"space-y-4",children:[(0,t.jsx)(d.Wi,{control:n.control,name:"path",render:e=>{let{field:r}=e;return(0,t.jsxs)(d.xJ,{children:[(0,t.jsx)(d.lX,{children:"下载路径"}),(0,t.jsx)(d.NI,{children:(0,t.jsx)(c.I,{...r})}),(0,t.jsx)(d.zG,{})]})}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"qBittorrent 配置"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(d.Wi,{control:n.control,name:"qbit_config.url",render:e=>{let{field:r}=e;return(0,t.jsxs)(d.xJ,{children:[(0,t.jsx)(d.NI,{children:(0,t.jsx)(c.I,{placeholder:"qBittorrent URL",...r})}),(0,t.jsx)(d.zG,{})]})}}),(0,t.jsx)(d.Wi,{control:n.control,name:"qbit_config.username",render:e=>{let{field:r}=e;return(0,t.jsxs)(d.xJ,{children:[(0,t.jsx)(d.NI,{children:(0,t.jsx)(c.I,{placeholder:"qBittorrent 用户名",...r})}),(0,t.jsx)(d.zG,{})]})}}),(0,t.jsx)(d.Wi,{control:n.control,name:"qbit_config.password",render:e=>{let{field:r}=e;return(0,t.jsxs)(d.xJ,{children:[(0,t.jsx)(d.NI,{children:(0,t.jsx)(c.I,{type:"password",placeholder:"qBittorrent 密码",...r})}),(0,t.jsx)(d.zG,{})]})}})]})]}),(0,t.jsx)(i.z,{type:"submit",children:"更新配置"})]})}),(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"修改密码"}),(0,t.jsx)(d.l0,{...u,children:(0,t.jsxs)("form",{onSubmit:u.handleSubmit(g),className:"space-y-4",children:[(0,t.jsx)(d.Wi,{control:u.control,name:"oldPassword",render:e=>{let{field:r}=e;return(0,t.jsxs)(d.xJ,{children:[(0,t.jsx)(d.lX,{children:"旧密码"}),(0,t.jsx)(d.NI,{children:(0,t.jsx)(c.I,{type:"password",...r,placeholder:"输入旧密码"})}),(0,t.jsx)(d.zG,{})]})}}),(0,t.jsx)(d.Wi,{control:u.control,name:"newPassword",render:e=>{let{field:r}=e;return(0,t.jsxs)(d.xJ,{children:[(0,t.jsx)(d.lX,{children:"新密码"}),(0,t.jsx)(d.NI,{children:(0,t.jsx)(c.I,{type:"password",...r,placeholder:"输入新密码"})}),(0,t.jsx)(d.zG,{})]})}}),(0,t.jsx)(d.Wi,{control:u.control,name:"confirmPassword",render:e=>{let{field:r}=e;return(0,t.jsxs)(d.xJ,{children:[(0,t.jsx)(d.lX,{children:"确认新密码"}),(0,t.jsx)(d.NI,{children:(0,t.jsx)(c.I,{type:"password",...r,placeholder:"再次输入新密码"})}),(0,t.jsx)(d.zG,{})]})}}),(0,t.jsx)(i.z,{type:"submit",children:"更新密码"})]})})]})]})}},495:(e,r,s)=>{"use strict";s.d(r,{z:()=>d});var t=s(7437),a=s(2265),n=s(1538),o=s(2218),l=s(7440);let i=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,r)=>{let{className:s,variant:a,size:o,asChild:d=!1,...c}=e,m=d?n.g7:"button";return(0,t.jsx)(m,{className:(0,l.cn)(i({variant:a,size:o,className:s})),ref:r,...c})});d.displayName="Button"},6661:(e,r,s)=>{"use strict";s.d(r,{l0:()=>m,NI:()=>w,pf:()=>g,Wi:()=>x,xJ:()=>p,lX:()=>j,zG:()=>b});var t=s(7437),a=s(2265),n=s(1538),o=s(9343),l=s(7440),i=s(8364);let d=(0,s(2218).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,r)=>{let{className:s,...a}=e;return(0,t.jsx)(i.f,{ref:r,className:(0,l.cn)(d(),s),...a})});c.displayName=i.f.displayName;let m=o.RV,u=a.createContext({}),x=e=>{let{...r}=e;return(0,t.jsx)(u.Provider,{value:{name:r.name},children:(0,t.jsx)(o.Qr,{...r})})},h=()=>{let e=a.useContext(u),r=a.useContext(f),{getFieldState:s,formState:t}=(0,o.Gc)(),n=s(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=r;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...n}},f=a.createContext({}),p=a.forwardRef((e,r)=>{let{className:s,...n}=e,o=a.useId();return(0,t.jsx)(f.Provider,{value:{id:o},children:(0,t.jsx)("div",{ref:r,className:(0,l.cn)("space-y-2",s),...n})})});p.displayName="FormItem";let j=a.forwardRef((e,r)=>{let{className:s,...a}=e,{error:n,formItemId:o}=h();return(0,t.jsx)(c,{ref:r,className:(0,l.cn)(n&&"text-destructive",s),htmlFor:o,...a})});j.displayName="FormLabel";let w=a.forwardRef((e,r)=>{let{...s}=e,{error:a,formItemId:o,formDescriptionId:l,formMessageId:i}=h();return(0,t.jsx)(n.g7,{ref:r,id:o,"aria-describedby":a?"".concat(l," ").concat(i):"".concat(l),"aria-invalid":!!a,...s})});w.displayName="FormControl";let g=a.forwardRef((e,r)=>{let{className:s,...a}=e,{formDescriptionId:n}=h();return(0,t.jsx)("p",{ref:r,id:n,className:(0,l.cn)("text-[0.8rem] text-muted-foreground",s),...a})});g.displayName="FormDescription";let b=a.forwardRef((e,r)=>{let{className:s,children:a,...n}=e,{error:o,formMessageId:i}=h(),d=o?String(null==o?void 0:o.message):a;return d?(0,t.jsx)("p",{ref:r,id:i,className:(0,l.cn)("text-[0.8rem] font-medium text-destructive",s),...n,children:d}):null});b.displayName="FormMessage"},3102:(e,r,s)=>{"use strict";s.d(r,{I:()=>o});var t=s(7437),a=s(2265),n=s(7440);let o=a.forwardRef((e,r)=>{let{className:s,type:a,...o}=e;return(0,t.jsx)("input",{type:a,className:(0,n.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...o})});o.displayName="Input"},2738:(e,r,s)=>{"use strict";s.d(r,{O:()=>n});var t=s(7437),a=s(7440);function n(e){let{className:r,...s}=e;return(0,t.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-primary/10",r),...s})}},7293:(e,r,s)=>{"use strict";s.d(r,{h:()=>a});var t=s(7776);let a=function(e){let{baseUrl:r}=e,s=[],t=[],a=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat(r).concat(e),o={...a};for(let e of s)o=e(o);let l=await fetch(n,o);for(let e of t){let r=await e(l);if("code"in r)return r;l=r}if(!l.ok)throw Error("HTTP error! status: ".concat(l.status));let i=await l.json();if(0!==i.code&&200!==i.code)throw Error("API error! code: ".concat(i.code,", message: ").concat(i.msg));return i};return{request:a,get:(e,r)=>a(e,{...r,method:"GET"}),post:(e,r,s)=>a(e,{...s,method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json",...null==s?void 0:s.headers}}),delete:(e,r)=>a(e,{...r,method:"DELETE"}),put:(e,r,s)=>a(e,{...s,method:"PUT",body:JSON.stringify(r),headers:{"Content-Type":"application/json",...null==s?void 0:s.headers}}),addRequestInterceptor:e=>{s.push(e)},addResponseInterceptor:e=>{t.push(e)}}}({baseUrl:s(357).env.NEXT_PUBLIC_API_BASE_URL||"/v1"});a.addRequestInterceptor(e=>{let r=localStorage.getItem("token");return r?{...e,headers:{...e.headers,Authorization:"Bearer ".concat(r)}}:e}),a.addResponseInterceptor(async e=>{if(401===e.status)return e;let r=await e.clone().json();return 0!==r.code&&200!==r.code?(t.Am.error(r.msg),Promise.reject(r.msg)):e})},7440:(e,r,s)=>{"use strict";s.d(r,{cn:()=>n});var t=s(4839),a=s(6164);function n(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,a.m6)((0,t.W)(r))}}},e=>{var r=r=>e(e.s=r);e.O(0,[776,976,446,39,130,215,744],()=>r(2150)),_N_E=e.O()}]);